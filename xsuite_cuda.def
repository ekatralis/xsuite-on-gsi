Bootstrap: docker
From: nvidia/cuda:11.8.0-runtime-ubuntu20.04

%labels
AUTHOR Philipp Niedermayer

%help
See https://git.gsi.de/p.niedermayer/xsuite-on-hpc

%files
example.py /xsuite/example.py

%post
apt update
DEBIAN_FRONTEND=noninteractive apt install -y python3 python3-pip libclfft-dev python3-gpyfft

pip install --upgrade pip
pip3 install --upgrade numpy scipy matplotlib pandas ipython pytest cython pyopencl pint
pip3 install cupy-cuda11x
pip3 install cpymad
pip3 install xsuite
pip3 install xplt

echo LD_LIBRARY_PATH=\"\$LD_LIBRARY_PATH:/usr/local/cuda/lib64:/usr/local/cuda/compat\" >> /environment
echo "export LD_LIBRARY_PATH" >> /environment

apt --purge remove -y .\*-doc$
apt --purge remove -y wget
apt clean -y
rm -rf /var/lib/apt/lists/*
pip3 cache purge
